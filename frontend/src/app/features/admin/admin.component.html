<div
  class="h-screen w-full bg-slate-50 flex overflow-hidden font-sans text-slate-900"
>
  <!-- 
    PREMIUM SIDEBAR 
    - Full height, fixed width
    - independent scroll for navigation
    - sticky footer for profile
  -->
  <aside
    class="flex-shrink-0 w-72 bg-slate-900 text-white flex flex-col h-full transition-transform duration-300 ease-in-out absolute z-50 lg:relative lg:translate-x-0 shadow-2xl lg:shadow-none print:hidden"
    [class.-translate-x-full]="!isSidebarOpen"
    [class.translate-x-0]="isSidebarOpen"
  >
    <!-- Logo Section -->
    <div
      class="h-20 flex-shrink-0 flex items-center px-8 border-b border-white/10 relative overflow-hidden"
    >
      <!-- Decorative Glow -->
      <div
        class="absolute top-0 left-0 w-full h-full bg-gradient-to-r from-indigo-500/10 to-transparent pointer-events-none"
      ></div>

      <div class="flex items-center gap-3 relative z-10">
        <div
          class="w-10 h-10 rounded-xl bg-gradient-to-br from-indigo-500 to-purple-600 flex items-center justify-center shadow-lg shadow-indigo-500/20"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            viewBox="0 0 24 24"
            fill="currentColor"
            class="w-6 h-6 text-white"
          >
            <path
              fill-rule="evenodd"
              d="M7.5 6a4.5 4.5 0 119 0 4.5 4.5 0 01-9 0zM3.751 20.105a8.25 8.25 0 0116.498 0 .75.75 0 01-.437.695A18.683 18.683 0 0112 22.5c-2.786 0-5.433-.608-7.812-1.7a.75.75 0 01-.437-.695z"
              clip-rule="evenodd"
            />
          </svg>
        </div>
        <span
          class="text-xl font-bold tracking-wide bg-gradient-to-r from-white to-slate-400 bg-clip-text text-transparent"
          >Nexus<span class="font-light text-slate-400">Admin</span></span
        >
      </div>
    </div>

    <!-- Navigation (Scrollable) -->
    <nav class="flex-1 overflow-y-auto py-6 px-4 space-y-1.5 custom-scrollbar">
      <div
        class="px-4 mb-2 text-xs font-bold text-slate-500 uppercase tracking-widest"
      >
        Menu Principal
      </div>

      <a
        routerLink="/admin/dashboard"
        routerLinkActive="bg-white/10 text-white shadow-lg shadow-indigo-900/10 border-indigo-500"
        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all duration-200 border-l-4 border-transparent group"
      >
        <span
          class="group-hover:scale-110 transition-transform duration-200 text-lg"
          >üìä</span
        >
        <span class="font-medium">Tableau de bord</span>
      </a>

      <a
        routerLink="/admin/users"
        routerLinkActive="bg-white/10 text-white shadow-lg shadow-indigo-900/10 border-indigo-500"
        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all duration-200 border-l-4 border-transparent group"
      >
        <span
          class="group-hover:scale-110 transition-transform duration-200 text-lg"
          >üë•</span
        >
        <span class="font-medium">Utilisateurs</span>
      </a>

      <a
        routerLink="/admin/orders"
        routerLinkActive="bg-white/10 text-white shadow-lg shadow-indigo-900/10 border-indigo-500"
        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all duration-200 border-l-4 border-transparent group"
      >
        <span
          class="group-hover:scale-110 transition-transform duration-200 text-lg"
          >üì¶</span
        >
        <div class="flex-1 flex items-center justify-between">
          <span class="font-medium">Commandes</span>
          <span
            *ngIf="(activeOrdersCount$ | async)! > 0"
            class="bg-indigo-500/20 text-indigo-300 border border-indigo-500/30 text-[10px] font-bold px-2 py-0.5 rounded-full"
            >+{{ activeOrdersCount$ | async }}</span
          >
        </div>
      </a>

      <a
        routerLink="/admin/products"
        routerLinkActive="bg-white/10 text-white shadow-lg shadow-indigo-900/10 border-indigo-500"
        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all duration-200 border-l-4 border-transparent group"
      >
        <span
          class="group-hover:scale-110 transition-transform duration-200 text-lg"
          >üõçÔ∏è</span
        >
        <span class="font-medium">Produits</span>
      </a>

      <a
        routerLink="/admin/promo"
        routerLinkActive="bg-white/10 text-white shadow-lg shadow-indigo-900/10 border-indigo-500"
        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all duration-200 border-l-4 border-transparent group"
      >
        <span
          class="group-hover:scale-110 transition-transform duration-200 text-lg"
          >üéüÔ∏è</span
        >
        <span class="font-medium">Promotions</span>
      </a>

      <div
        class="px-4 mt-8 mb-2 text-xs font-bold text-slate-500 uppercase tracking-widest"
      >
        Param√®tres
      </div>

      <a
        routerLink="/admin/profile"
        routerLinkActive="bg-white/10 text-white shadow-lg shadow-indigo-900/10 border-indigo-500"
        class="flex items-center gap-3 px-4 py-3 rounded-xl text-slate-400 hover:text-white hover:bg-white/5 transition-all duration-200 border-l-4 border-transparent group"
      >
        <span
          class="group-hover:scale-110 transition-transform duration-200 text-lg"
          >üë§</span
        >
        <span class="font-medium">Mon Profil</span>
      </a>
    </nav>

    <!-- User Profile Footer (Fixed at Bottom) -->
    <div
      class="flex-shrink-0 p-4 border-t border-white/10 bg-black/20 backdrop-blur-sm"
    >
      <div
        class="flex items-center gap-3 p-3 rounded-xl hover:bg-white/5 transition-colors cursor-pointer group"
      >
        <div class="relative">
          <div
            class="w-10 h-10 rounded-full bg-gradient-to-tr from-blue-500 to-indigo-500 flex items-center justify-center text-white font-bold ring-2 ring-white/10 group-hover:ring-white/30 transition-all"
          >
            A
          </div>
          <div
            class="absolute bottom-0 right-0 w-3 h-3 bg-green-500 rounded-full border-2 border-slate-900"
          ></div>
        </div>
        <div class="flex-1 min-w-0">
          <p class="text-sm font-medium text-white truncate">Administrateur</p>
          <p class="text-xs text-slate-400 truncate">
            {{ (user$ | async)?.email }}
          </p>
        </div>
        <button
          (click)="logout()"
          class="text-slate-400 hover:text-red-400 transition-colors p-2 rounded-lg hover:bg-white/5"
          title="D√©connexion"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            class="w-5 h-5"
            fill="none"
            viewBox="0 0 24 24"
            stroke="currentColor"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              stroke-width="2"
              d="M17 16l4-4m0 0l-4-4m4 4H7m6 4v1a3 3 0 01-3 3H6a3 3 0 01-3-3V7a3 3 0 013-3h4a3 3 0 013 3v1"
            />
          </svg>
        </button>
      </div>
    </div>
  </aside>

  <!-- Main Content Wrapper -->
  <div
    class="flex-1 flex flex-col h-full overflow-hidden relative print:overflow-visible print:h-auto"
  >
    <!-- 
      GLASS HEADER 
      - Fixed height
    -->
    <header
      class="h-20 bg-white border-b border-slate-200 flex items-center justify-between px-8 shadow-sm z-20 flex-shrink-0 print:hidden"
    >
      <div class="flex items-center gap-4">
        <!-- Mobile Toggle -->
        <button
          (click)="isSidebarOpen = !isSidebarOpen"
          class="lg:hidden p-2 -ml-2 text-slate-500 hover:bg-slate-100 rounded-lg transition-colors"
        >
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="1.5"
            stroke="currentColor"
            class="w-6 h-6"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M3.75 6.75h16.5M3.75 12h16.5m-16.5 5.25h16.5"
            />
          </svg>
        </button>

        <!-- Search Bar -->
        <div class="hidden md:flex relative group w-96">
          <div
            class="absolute inset-y-0 left-0 pl-3 flex items-center pointer-events-none"
          >
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="w-5 h-5 text-slate-400 group-focus-within:text-indigo-500 transition-colors"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M21 21l-5.197-5.197m0 0A7.5 7.5 0 105.196 5.196a7.5 7.5 0 0010.607 10.607z"
              />
            </svg>
          </div>
          <input
            type="text"
            placeholder="Rechercher (Ctrl+K)"
            (click)="cmdPalette.isOpen = true"
            readonly
            class="block w-full pl-10 pr-12 py-2.5 bg-slate-50 border border-slate-200 rounded-xl text-sm text-slate-900 placeholder-slate-400 focus:outline-none focus:ring-2 focus:ring-indigo-500 focus:border-transparent focus:bg-white transition-all duration-200 cursor-pointer"
          />
          <div
            class="absolute inset-y-0 right-0 flex items-center pr-3 pointer-events-none"
          >
            <span
              class="text-xs font-bold text-slate-400 border border-slate-200 rounded px-1.5 py-0.5 bg-white shadow-sm"
              >‚åòK</span
            >
          </div>
        </div>
      </div>

      <!-- Right Actions -->
      <div class="flex items-center gap-4">
        <!-- Notifications -->
        <!-- Notifications -->
        <div class="relative z-50">
          <button
            (click)="toggleNotifications()"
            class="p-2.5 text-slate-500 hover:bg-slate-50 hover:text-indigo-600 rounded-full transition-all relative group"
            [ngClass]="{ 'bg-indigo-50 text-indigo-600': isNotificationsOpen }"
          >
            <span
              *ngIf="(unreadCount$ | async)! > 0"
              class="absolute top-2.5 right-2.5 w-2 h-2 bg-red-500 rounded-full border-2 border-white pointer-events-none animate-pulse"
            ></span>
            <svg
              xmlns="http://www.w3.org/2000/svg"
              fill="none"
              viewBox="0 0 24 24"
              stroke-width="2"
              stroke="currentColor"
              class="w-6 h-6"
            >
              <path
                stroke-linecap="round"
                stroke-linejoin="round"
                d="M14.857 17.082a23.848 23.848 0 005.454-1.31A8.967 8.967 0 0118 9.75v-.7V9A6 6 0 006 9v.75a8.967 8.967 0 01-2.312 6.022c1.733.64 3.56 1.085 5.455 1.31m5.714 0a24.255 24.255 0 01-5.714 0m5.714 0a3 3 0 11-5.714 0"
              />
            </svg>
          </button>

          <!-- Dropdown -->
          <div
            *ngIf="isNotificationsOpen"
            class="absolute top-12 right-0 w-80 bg-white rounded-2xl shadow-xl border border-slate-100 overflow-hidden animate-in fade-in slide-in-from-top-2 origin-top-right transform transition-all z-50 notification-dropdown"
          >
            <div
              class="p-4 border-b border-slate-50 flex items-center justify-between bg-slate-50/50 backdrop-blur-sm"
            >
              <h3 class="font-bold text-slate-800 text-sm">Notifications</h3>
              <div class="flex gap-2">
                <button
                  (click)="markAllAsRead()"
                  class="text-[10px] font-bold text-indigo-600 hover:underline"
                >
                  Tout lire
                </button>
                <button
                  (click)="clearAll()"
                  class="text-[10px] font-bold text-slate-400 hover:text-slate-600"
                >
                  Effacer
                </button>
              </div>
            </div>

            <div class="max-h-[300px] overflow-y-auto custom-scrollbar">
              <div
                *ngIf="(notifications$ | async)?.length === 0"
                class="p-8 text-center text-slate-400 text-xs"
              >
                Aucune notification active
              </div>

              <div
                *ngFor="let note of notifications$ | async"
                class="p-4 border-b border-slate-50 hover:bg-slate-50 transition-colors cursor-pointer relative group"
                [ngClass]="{ 'bg-indigo-50/10': true }"
                (click)="markAsRead(note.id)"
                [routerLink]="note.link ? note.link : null"
              >
                <div class="flex gap-3 items-start justify-between">
                  <div class="flex gap-3 items-start">
                    <div
                      class="mt-0.5 w-2 h-2 rounded-full flex-shrink-0"
                      [ngClass]="{
                        'bg-indigo-500': note.type === 'ORDER',
                        'bg-amber-500': note.type === 'STOCK',
                        'bg-red-500': note.type === 'SYSTEM'
                      }"
                    ></div>
                    <div>
                      <p
                        class="text-xs font-medium text-slate-800 leading-snug"
                      >
                        {{ note.message }}
                      </p>
                      <p class="text-[10px] text-slate-400 mt-1">
                        {{ note.timestamp | date : "shortTime" }}
                      </p>
                    </div>
                  </div>
                  <!-- Delete Button for removing item without following link -->
                  <button
                    (click)="$event.stopPropagation(); markAsRead(note.id)"
                    class="text-slate-300 hover:text-red-400 p-1 opacity-0 group-hover:opacity-100 transition-all"
                  >
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      fill="none"
                      viewBox="0 0 24 24"
                      stroke-width="2"
                      stroke="currentColor"
                      class="w-3 h-3"
                    >
                      <path
                        stroke-linecap="round"
                        stroke-linejoin="round"
                        d="M6 18L18 6M6 6l12 12"
                      />
                    </svg>
                  </button>
                </div>
              </div>
            </div>
            <!-- Overlay to close on click outside -->
            <div
              class="fixed inset-0 z-0"
              (click)="isNotificationsOpen = false"
              style="z-index: -1"
            ></div>
          </div>
          <!-- Global Backdrop for clicking outside (invisible) -->
          <div
            *ngIf="isNotificationsOpen"
            class="fixed inset-0 z-40 bg-transparent"
            (click)="isNotificationsOpen = false"
          ></div>
        </div>

        <div class="h-8 w-px bg-slate-200 mx-1"></div>

        <!-- Profile -->
        <div
          class="flex items-center gap-3 cursor-pointer p-1.5 pr-3 rounded-full hover:bg-slate-50 transition-colors border border-transparent hover:border-slate-200"
        >
          <div
            class="w-9 h-9 rounded-full bg-gradient-to-br from-indigo-500 to-purple-500 text-white flex items-center justify-center font-bold text-sm ring-2 ring-white shadow-md"
          >
            AD
          </div>
          <div class="hidden md:block">
            <p class="text-sm font-bold text-slate-700 leading-none">Admin</p>
            <p class="text-[10px] text-slate-400 font-semibold mt-0.5">
              Super Admin
            </p>
          </div>
          <svg
            xmlns="http://www.w3.org/2000/svg"
            fill="none"
            viewBox="0 0 24 24"
            stroke-width="2"
            stroke="currentColor"
            class="w-4 h-4 text-slate-400 hidden md:block"
          >
            <path
              stroke-linecap="round"
              stroke-linejoin="round"
              d="M19.5 8.25l-7.5 7.5-7.5-7.5"
            />
          </svg>
        </div>
      </div>
    </header>

    <!-- Page Content (Scrollable) -->
    <main
      class="flex-1 overflow-y-auto p-4 md:p-8 custom-scrollbar print:overflow-visible print:h-auto"
    >
      <router-outlet></router-outlet>
    </main>
  </div>
</div>

<!-- Mobile Overlay -->
<div
  *ngIf="isSidebarOpen"
  class="fixed inset-0 bg-slate-900/50 backdrop-blur-sm z-40 lg:hidden"
  (click)="isSidebarOpen = false"
></div>

<!-- Global Command Palette -->
<app-command-palette #cmdPalette></app-command-palette>
